{% extends "orga/base.html" %}

{% load staff_session %}
{% load i18n %}
{% load rules %}
{% load static %}

{% block extra_title %}{{ page_obj.paginator.count }} {% blocktranslate trimmed count count=page_obj.paginator.count %}submitter{% plural %}submitters{% endblocktranslate %} :: {% endblock extra_title %}

{% block custom_header %}
<link rel="stylesheet" href="{% static 'orga/css/speaker-list.css' %}?v=3">
{% endblock %}

{% block scripts %}
{{ block.super }}
<script src="{% static 'sortable/Sortable.js' %}"></script>
<script src="{% static 'orga/js/speaker-list.js' %}"></script>
{% endblock scripts %}

{% block content %}
<div class="d-md-flex justify-content-between">
    <h2>
        {{ page_obj.paginator.count }}
        {% blocktranslate trimmed count count=page_obj.paginator.count %}
        submitter
        {% plural %}
        submitters
        {% endblocktranslate %}
    </h2>
    {% include "orga/event/component_link.html" %}
</div>

{% include "common/includes/search_form.html" %}

{% if filter_form.is_valid and filter_form.cleaned_data.question %}
<p class="text-muted ml-2">
    <span class="fa fa-filter"></span>
    {% blocktranslate trimmed with question=filter_form.cleaned_data.question.question %}
    List filtered by responses to custom field “{{ question }}”.
    {% endblocktranslate %}
    <a href="{% querystring question="" answer="" answer__options="" %}" class="text-muted">
        <span class="fa fa-times"></span>
        {% translate "Remove filter" %}
    </a>
</p>
{% endif %}

{% has_event_perm "base.mark_arrived_speakerprofile" request.user request request.event as can_mark_speaker %}
<div class="table-responsive-always" id="speaker-list-wrapper">
    <table class="table table-sm table-flip table-sticky speaker-list-table">
        <thead>
            <tr>
                <th class="speaker-drag-column"></th>
                <th class="speaker-name-column">{% translate "Name" %}</th>
                <th class="speaker-accepted-column">{% translate "Accepted Proposals" %}</th>
                <th class="speaker-proposals-column">{% translate "Proposals" %}</th>
                <th class="speaker-featured-column">{% translate "Featured" %}</th>
                <th class="speaker-arrival-column">{% translate "Arrival" %}</th>
            </tr>
        </thead>
        <tbody id="speaker-tbody" data-reorder-url="{% url 'orga:speakers.reorder' event=request.event.slug %}">
            {% for profile in speakers %}
            <tr data-speaker-id="{{ profile.id }}">
                <td class="drag-handle" title="{% translate 'Drag to reorder' %}"
                    aria-label="{% translate 'Drag to reorder' %}">
                    <i class="fa fa-bars" aria-hidden="true"></i>
                </td>
                <td class="speaker-name-cell">
                    <a href="{{ profile.orga_urls.base }}">
                        {% include "orga/includes/user_name.html" with user=profile.user %}
                    </a>
                </td>
                <td class="speaker-accepted-column">{{ profile.accepted_submission_count }}</td>
                <td class="speaker-proposals-column">{{ profile.submission_count }}</td>
                <td class="speaker-featured-column">
                    <input type="checkbox" class="featured-checkbox"
                        data-featured-url="{% url 'orga:speakers.featured' event=request.event.slug code=profile.user.code %}"
                        {% if profile.is_featured %}checked{% endif %}
                        title="{% translate 'Mark as featured speaker' %}"
                        aria-label="{% translate 'Mark as featured speaker' %}">
                </td>
                <td class="speaker-arrival-cell">
                    {% if profile.accepted_submission_count %}
                    {% if can_mark_speaker %}
                    <a class="btn btn-sm btn-{{ profile.has_arrived|yesno:" success,info" }}"
                        href="{{ profile.orga_urls.toggle_arrived }}?from=list">
                        {% if profile.has_arrived %}
                        {% translate "Mark speaker as not arrived" %}
                        {% else %}
                        {% translate "Mark speaker as arrived" %}
                        {% endif %}
                    </a>
                    {% else %}
                    {% if profile.has_arrived %}
                    <a><i class="fa fa-check"></i> {% translate "Arrived" %}</a>
                    {% else %}
                    <a><i class="fa fa-times"></i> {% translate "Not arrived" %}</a>
                    {% endif %}
                    {% endif %}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% include "orga/includes/pagination.html" %}

{% endblock content %}
