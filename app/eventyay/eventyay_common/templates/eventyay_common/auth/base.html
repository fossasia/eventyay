{% load compress %}
{% load i18n %}
{% load static %}
{% load statici18n %}
{% load eventsignal %}
{% load eventurl %}
<!DOCTYPE html>
<html{% if rtl %} dir="rtl" class="rtl" {% endif %}>

    <head>
        <title>{{ INSTANCE_NAME }}</title>
        {% compress css %}
        {% if request.user.is_authenticated %}
        <link rel="stylesheet" type="text/x-scss" href="{% static 'pretixcontrol/scss/main.scss' %}" />
        <link rel="stylesheet" type="text/x-scss" href="{% static 'lightbox/css/lightbox.scss' %}" />
        <link rel="stylesheet" type="text/css" href="{% static 'common/css/_dropdown.css' %}" />
        <link rel="stylesheet" href="{% static 'eventyay-common/css/dashboard.css' %}">
        <link rel="stylesheet" href="{% static 'eventyay-common/css/settings.css' %}" />
        {% else %}
        <link rel="stylesheet" type="text/x-scss" href="{% static "pretixcontrol/scss/auth.scss" %}" />
        <link rel="stylesheet" type="text/x-scss" href="{% static "pretixcontrol/scss/main.scss" %}" />
        {% endif %}
        {% endcompress %}
        {% if DEBUG %}
        <script type="text/javascript" src="{% url 'javascript-catalog' lang=request.LANGUAGE_CODE %}" defer></script>
        {% else %}
        <script src="{% statici18n request.LANGUAGE_CODE %}" async></script>
        {% endif %}
        {% compress js %}
        {% if request.user.is_authenticated %}
        <script type="text/javascript" src="{% static "jquery/js/jquery-2.1.1.min.js" %}"></script>
        <script type="text/javascript" src="{% static "js/jquery.formset.js" %}"></script>
        <script type="text/javascript" src="{% static "typeahead/typeahead.bundle.js" %}"></script>
        <script type="text/javascript" src="{% static "bootstrap/js/bootstrap.js" %}"></script>
        <script type="text/javascript" src="{% static "moment/moment-with-locales.js" %}"></script>
        <script type="text/javascript" src="{% static "datetimepicker/bootstrap-datetimepicker.js" %}"></script>
        <script type="text/javascript" src="{% static "select2/select2.js" %}"></script>
        <script type="text/javascript" src="{% static "select2/i18n/de.js" %}"></script>
        <script type="text/javascript" src="{% static "select2/i18n/en.js" %}"></script>
        <script type="text/javascript" src="{% static "charts/raphael-min.js" %}"></script>
        <script type="text/javascript" src="{% static "charts/morris.js" %}"></script>
        <script type="text/javascript" src="{% static "clipboard/clipboard.js" %}"></script>
        <script type="text/javascript" src="{% static "rrule/rrule.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixpresale/js/ui/questions.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixcontrol/js/jquery.qrcode.min.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixcontrol/js/clipboard.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixcontrol/js/menu.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixcontrol/js/sb-admin-2.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixcontrol/js/ui/main.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixcontrol/js/ui/quota.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixcontrol/js/ui/subevent.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixcontrol/js/ui/question.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixcontrol/js/ui/dragndroplist.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixcontrol/js/ui/mail.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixcontrol/js/ui/orderchange.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixcontrol/js/ui/typeahead.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixcontrol/js/ui/quicksetup.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixcontrol/js/ui/dashboard.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixcontrol/js/ui/tabs.js" %}"></script>
        <script type="text/javascript" src="{% static "leaflet/leaflet.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixbase/js/details.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixbase/js/asynctask.js" %}"></script>
        <script type="text/javascript" src="{% static "sortable/Sortable.js" %}"></script>
        <script type="text/javascript" src="{% static "colorpicker/bootstrap-colorpicker.js" %}"></script>
        <script type="text/javascript" src="{% static 'fileupload/jquery.ui.widget.js' %}"></script>
        <script type="text/javascript" src="{% static 'fileupload/jquery.fileupload.js' %}"></script>
        <script type="text/javascript" src="{% static 'lightbox/js/lightbox.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'are-you-sure/jquery.are-you-sure.js' %}"></script>
        <script type="text/javascript" src="{% static 'eventyay-common/js/ui/popover.js' %}"></script>
        <script type="text/javascript" src="{% static 'utils/js/utils.js' %}"></script>
        <script type="text/javascript" src="{% static 'eventyay-common/js/ui/team.js' %}"></script>
        <script type="module" src="{% static 'common/js/dropdown.js' %}"></script>
        {% else %}
        <script type="text/javascript" src="{% static "jquery/js/jquery-3.7.1.min.js" %}"></script>
        <script type="text/javascript" src="{% static "bootstrap/js/bootstrap.js" %}"></script>
        <script type="text/javascript" src="{% static "pretixcontrol/js/ui/collapse_state.js" %}"></script>
        {% endif %}
        {% endcompress %}
        <meta name="viewport" content="width=device-width, initial-scale=1">

        {% if development_warning or debug_warning %}
        <link rel="shortcut icon" href="{% static "common/img/icons/favicon_debug.ico" %}">
        {% else %}
        <link rel="shortcut icon" href="{% static "common/img/icons/favicon.ico" %}">
        <link rel="icon" type="image/png" sizes="32x32" href="{% static "pretixbase/img/icons/favicon-32x32.png" %}">
        <link rel="icon" type="image/png" sizes="194x194" href="{% static "pretixbase/img/icons/favicon-194x194.png" %}">
        <link rel="icon" type="image/png" sizes="16x16" href="{% static "pretixbase/img/icons/favicon-16x16.png" %}">
        {% endif %}
        <link rel="apple-touch-icon" sizes="180x180" href="{% static "pretixbase/img/icons/apple-touch-icon.png" %}">
        <link rel="icon" type="image/png" sizes="192x192" href="{% static "pretixbase/img/icons/android-chrome-192x192.png" %}">
        {% if request.user.is_authenticated %}
        <link rel="manifest" href="{% url "presale:site.webmanifest" %}">
        {% else %}
        {% comment %}
        <link rel="manifest" href="{% url "presale:site.webmanifest" %}"> {% endcomment %}
        {% endif %}
        <link rel="mask-icon" href="{% static "pretixbase/img/icons/safari-pinned-tab.svg" %}" color="#2185d0">
        <meta name="msapplication-TileColor" content="#2185d0">
        {% if request.user.is_authenticated %}
        <meta name="msapplication-config" content="{% url "presale:browserconfig.xml" %}">
        {% else %}
        {% comment %}
        <meta name="msapplication-config" content="{% url "presale:browserconfig.xml" %}"> {% endcomment %}
        {% endif %}
        <meta name="theme-color" content="#2185d0">
        {% if request.user.is_authenticated %}
        <meta name="referrer" content="origin">
        {% endif %}
        {{ html_head|safe }}
        {% block custom_header %}{% endblock %}
    </head>

    <body {% if request.user.is_authenticated %} data-datetimeformat="{{ js_datetime_format }}"
        data-timeformat="{{ js_time_format }}" data-dateformat="{{ js_date_format }}"
        data-datetimelocale="{{ js_locale }}" data-pretixlocale="{{ request.LANGUAGE_CODE }}"
        data-payment-weekdays-disabled="{{ js_payment_weekdays_disabled }}" {% if request.organizer %}data-organizer="{{ request.organizer.slug }}" {% endif %} {% if request.event %}data-event="{{ request.event.slug }}" {% endif %} data-select2-locale="{{ select2locale }}"
        data-longdateformat="{{ js_long_date_format }}" class="nojs sidebar-minimized" {% else %} class="nojs" {% endif %}>
        <div id="wrapper">
            {% if request.user.is_authenticated %}
            <nav class="navbar navbar-inverse navbar-static-top" role="navigation">
                <button type="button" class="navbar-toggle-sidebar navbar-toggle" id="sidebar-toggle"
                    data-toggle="sidebar">
                    <span class="sr-only">{% trans "Toggle sidebar" %}</span>
                    <i class="fa fa-bars fa-lg"></i>
                </button>
                <div class="navbar-header">
                    {% if request.event %}
                    {% if has_domain and not request.event.live %}
                    <form action="{% eventurl request.event 'presale:event.auth' %}" method="post" target="_blank"
                        class="mobile-navbar-view-form visible-xs-block">
                        {% csrf_token %}
                        <input type="hidden" value="{{ new_session }}" name="session">
                        <button type="submit" class="btn btn-link navbar-toggle">
                            <i class="fa fa-eye"></i>
                        </button>
                    </form>
                    {% else %}
                    <a href="{% eventurl request.event 'presale:event.index' %}" title="{% translate "View event" %}"
                        target="_blank" class="navbar-toggle mobile-navbar-view-link">
                        <i class="fa fa-eye"></i>
                    </a>
                    {% endif %}
                    {% endif %}
                    <a class="navbar-brand" href="{% url 'eventyay_common:dashboard' %}">
                        <img src="{% static 'pretixbase/img/eventyay-icon.svg' %}" />
                        {{ INSTANCE_NAME }}
                    </a>
                </div>
                <ul class="nav navbar-nav navbar-top-links navbar-left flip hidden-xs">
                    {% if request.event %}
                    <li>
                        {% if has_domain and not request.event.live %}
                        <form action="{% eventurl request.event 'presale:event.auth' %}" method="post" target="_blank">
                            {% csrf_token %}
                            <input type="hidden" value="{{ new_session }}" name="session">
                            <button type="submit" class="btn btn-link" id="button-shop">
                                <i class="fa fa-eye"></i> {% translate "View event" %}
                            </button>
                        </form>
                        {% else %}
                        <a href="{% eventurl request.event 'presale:event.index' %}"
                            title="{% translate 'View event' %}" target="_blank">
                            <i class="fa fa-eye"></i> {% translate 'View event' %}
                        </a>
                        {% endif %}
                    </li>
                    {% endif %}
                </ul>
                <ul class="nav navbar-nav navbar-top-links navbar-right flip">
                    <li class="language-switch">
                        <form method="post" action="{% url 'eventyay_common:account.locale' %}" class="language-form">
                            {% csrf_token %}
                            <input type="hidden" name="next" value="{{ request.get_full_path }}">

                            <details class="dropdown locales" aria-haspopup="menu">
                                <summary class="language-summary" aria-label="{{ _('Language') }}">
                                    {% for option in language_options %}
                                    {% if option.code|lower == request.LANGUAGE_CODE|lower %}
                                    <span class="current-locale">{{ option.label }}</span>
                                    {% endif %}
                                    {% endfor %}
                                    <i class="fa fa-caret-down ml-1" aria-hidden="true"></i>
                                </summary>

                                <div class="dropdown-content dropdown-content-s{% if rtl %}e{% else %}w{% endif %}"
                                    role="menu">
                                    {% for option in language_options %}
                                    <button type="submit" name="locale" value="{{ option.code }}"
                                        class="dropdown-item {% if option.code|lower == request.LANGUAGE_CODE|lower %}active{% endif %}"
                                        role="menuitem">
                                        {{ option.label }}
                                    </button>
                                    {% endfor %}
                                </div>
                            </details>
                        </form>
                    </li>
                    {% if request.user.is_staff and not staff_session %}
                    <li>
                        <form action="{% url 'control:user.sudo' %}?next={{ request.path|add:"?"|add:request.GET.urlencode|urlencode }}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-link" id="button-sudo">
                                <i class="fa fa-id-card"></i> {% trans "Admin mode" %}
                            </button>
                        </form>
                    </li>
                    {% elif request.user.is_staff and staff_session %}
                    <li>
                        <a href="{% url 'control:user.sudo.stop' %}" class="danger">
                            <i class="fa fa-id-card"></i> {% trans "End admin session" %}
                        </a>
                    </li>
                    {% endif %}
                    {{ 'popover-profile'|json_script:"popover_toggle" }}
                    {{ base_path|json_script:"base_path" }}
                    {{ staff_session|json_script:"is_admin_mode" }}
                    {{ talk_hostname|json_script:"talk_hostname_url" }}
                    {% include "common/fragment_profile_dropdown.html" %}
                </ul>
                <div class="navbar-default sidebar" role="navigation">
                    <div class="sidebar-nav navbar-nav-collapse navbar-collapse">
                        <div class="dropdown context-selector">
                            {% block nav_top_header %}
                            {% if request.event %}
                            <a href="{% url 'eventyay_common:event.index' organizer=request.event.organizer.slug event=request.event.slug %}"
                                class="dropdown-toggle">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-dashboard fa-stack-1x fa-inverse"></i>
                                </span>
                                <div class="context-indicator">
                                    <span class="context-name">{{ request.event }}</span>
                                    <span class="context-meta">{{ request.event.get_date_range_display }}</span>
                                </div>
                            </a>
                            {% elif request.organizer %}
                            <a href="#" class="dropdown-toggle">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-group fa-stack-1x fa-inverse"></i>
                                </span>
                                <div class="context-indicator">
                                    <span class="context-name">{{ request.organizer }}</span>
                                    <span class="context-meta">{% translate "Organizer account" %}</span>
                                </div>
                            </a>
                            {% else %}
                            <a href="{% url 'eventyay_common:dashboard' %}" class="dropdown-toggle">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-dashboard fa-stack-1x fa-inverse"></i>
                                </span>
                                <div class="context-indicator">
                                    <span class="context-name">{% translate "Main dashboard" %}</span>
                                </div>
                            </a>
                            {% endif %}
                            {% endblock %}
                        </div>
                        <ul class="nav" id="side-menu">
                            {% block nav %}
                            {% for nav in nav_items %}
                            <li>
                                <a href="{{ nav.url }}" class="
                                        nav-item-label
                                        {% if nav.active %} active{% endif %}
                                        {% if nav.children %} has-children{% endif %}
                                    " {% if nav.external %}target="_blank" {% endif %}>
                                    {% if nav.icon %}
                                    {% if "<svg" in nav.icon %} {{ nav.icon|safe }} {% else %} <span
                                        class="fa fa-fw fa-{{ nav.icon }}"></span>
                                        {% endif %}
                                        {% endif %}
                                        <span class="sidebar-text">{{ nav.label }}</span>
                                </a>
                                {% if nav.children %}
                                <a href="#" class="arrow">
                                    <span class="fa arrow"></span>
                                </a>
                                <ul class="nav nav-second-level">
                                    {% for item in nav.children %}
                                    <li>
                                        <a href="{{ item.url }}" {% if item.external %}target="_blank" {% endif %} {% if item.active %}class="active" {% endif %}>
                                            <span class="sidebar-text">{{ item.label }}</span>
                                        </a>
                                    </li>
                                    {% endfor %}
                                </ul>
                                {% endif %}
                            </li>
                            {% endfor %}
                            {% endblock %}
                        </ul>
                        {% include "pretixcontrol/base_after_nav.html" %}
                    </div>
                </div>
            </nav>
            {% else %}
            <nav class="navbar navbar-inverse navbar-static-top" role="navigation">
                <div class="navbar-header">
                    <a class="navbar-brand" href='{% url "eventyay_common:dashboard" %}'>
                        <img src='{% static "pretixbase/img/eventyay-icon.svg" %}' />
                        {{ INSTANCE_NAME }}
                    </a>
                </div>
                <ul class="nav navbar-nav navbar-top-links navbar-right flip">
                    {% if show_link_in_header_for_all_pages %}
                    {% for page in show_link_in_header_for_all_pages %}
                    <li>
                        <a href='{% url "page" slug=page.slug %}' title='{{ page.title|safe }}'>
                            {{ page.title|safe }}
                        </a>
                    </li>
                    {% endfor %}
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        </div>
        {% if request.user.is_authenticated %}
        <div id="page-wrapper">
            <div class="container-fluid">
                {% signal "eventyay.control.signals.html_page_start" request %}
                <span id="organizer-messages"></span>
                {% else %}
                <div class="container">
                {% endif %}
                <a href="{% url "eventyay_common:auth.login" %}">
                    <img src="{% static "pretixbase/img/eventyay-logo.svg" %}" class="logo" />
                </a>
                {% if messages %}
                {% for message in messages %}
                <div class="alert {{ message.tags }}">
                    {% if request.user.is_authenticated %}
                    {{ message|linebreaksbr }}
                    {% else %}
                    {{ message }}
                    {% endif %}
                </div>
                {% endfor %}
                {% endif %}
                {% comment %} {% if request.user.is_hijacked %}
                <div class="impersonate-warning">
                    <span class="fa fa-user-secret"></span>
                    {% blocktrans with user=request.user%}You are currently working on behalf of {{ user }}.{%
                    endblocktrans %}

                    <form action="{% url 'admin.users.impersonate.stop' %}" method="post"
                        class="helper-display-inline">
                        {% csrf_token %}
                        <button class="btn btn-default btn-sm">
                            {% translate "Stop impersonating" %}
                        </button>
                    </form>
                </div>
                {% endif %} {% endcomment %}

                {% block content %}
                {% endblock %}
                <footer>
                    {% with "href='https://eventyay.com'" as a_attr %}
                    {% blocktrans trimmed %}
                    powered by <a {{ a_attr }}>eventyay</a>
                    {% endblocktrans %}
                    {% endwith %}
                    <ul class="list-inline text-center" style="margin-top: 20px">
                        {% if show_link_in_footer_for_all_pages %}
                        {% for page in show_link_in_footer_for_all_pages %}
                        <li>
                            <a href='{% url "page" slug=page.slug %}' title='{{ page.title|safe }}'>
                                {{ page.title|safe }}
                            </a>
                        </li>
                        {% endfor %}
                        {% endif %}
                    </ul>
                </footer>
                    {% if request.user.is_authenticated %}
                </div>
            </div>
            {% else %}
        </div>
        {% endif %}
    </body>

    </html>
    