{% extends "pretixcontrol/items/base.html" %}
{% load compress %}
{% load i18n %}
{% load bootstrap3 %}
{% load rich_text %}
{% load static %}
{% block title %}{% trans "Order forms" %}{% endblock %}

{% block custom_header %}
    {{ block.super }}
    {% compress css %}
        <link rel="stylesheet" href="{% static 'pretixcontrol/css/order-form-toggles.css' %}">
    {% endcompress %}
    {% compress js %}
        <script defer src="{% static 'pretixcontrol/js/orderFormToggles.js' %}"></script>
    {% endcompress %}
{% endblock %}
{% block inside %}
    <nav id="event-nav" class="header-nav">
        <div class="navigation">
            <div class="navigation-title">
                <h1>{% trans "Order forms" %}</h1>
            </div>
            {% include "pretixcontrol/event/component_link.html" %}
        </div>
    </nav>
    
    <form action="" method="post" class="form-horizontal" enctype="multipart/form-data">
        {% csrf_token %}
        {% bootstrap_form_errors sform %}
        
        <fieldset>
            <legend>{% trans "Customer data (once per order)" %}</legend>
            <div class="table-responsive-sm">
                <table class="table table-sm order-form-option-table">
                    <colgroup>
                        <col class="field-col" style="width: auto;">
                        <col style="width: 115px;">
                        <col style="width: 150px;">
                        <col style="width: 135px;">
                    </colgroup>
                    <thead>
                        <tr>
                            <th>{% trans "Field" %}</th>
                            <th class="text-center">{% trans "Active" %}</th>
                            <th class="text-center">{% trans "Required" %}</th>
                            <th class="text-center">{% trans "Settings" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {# E-mail #}
                        {% with field=sform.order_email_asked_required %}
                        {% if field %}
                        <tr>
                            <th>{% trans "E-mail" %}</th>
                            <td class="text-center">
                                <label class="toggle-switch" data-field-id="{{ field.auto_id }}"
                                    aria-label="Toggle active state for E-mail">
                                    <input type="checkbox" {% if field.value != 'do_not_ask' %}checked{% endif %}
                                        aria-label="Active toggle for E-mail">
                                    <span class="toggle-slider"></span>
                                </label>
                                <input type="hidden" name="{{ field.html_name }}" value="{{ field.value }}"
                                    id="{{ field.auto_id }}">
                            </td>
                            <td class="text-center">
                                <div class="required-status-wrapper" data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}">
                                    <select class="required-status-dropdown" data-field-id="{{ field.auto_id }}"
                                        data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}"
                                        aria-label="Required status for E-mail">
                                        <option value="optional" {% if field.value == 'optional' or field.value == 'do_not_ask' %}selected{% endif %}>Optional</option>
                                        <option value="required" {% if field.value == 'required' %}selected{% endif %}>Required</option>
                                    </select>
                                </div>
                            </td>
                            <td class="text-center"><span class="text-muted">—</span></td>
                        </tr>
                        {% endif %}
                        {% endwith %}

                        {# Ask for email twice #}
                        {% with field=sform.order_email_asked_twice %}
                        <tr>
                            <th>{% trans "Ask for the order email address twice" %}</th>
                            <td class="text-center">
                                <label class="toggle-switch" data-field-id="{{ field.auto_id }}"
                                    aria-label="Toggle active state for Ask email twice">
                                    <input type="checkbox" {% if field.value %}checked{% endif %}
                                        aria-label="Active toggle for Ask email twice">
                                    <span class="toggle-slider"></span>
                                </label>
                                <input type="hidden" name="{{ field.html_name }}" value="{% if field.value %}True{% else %}False{% endif %}"
                                    id="{{ field.auto_id }}">
                            </td>
                            <td class="text-center">
                                <span class="text-muted">—</span>
                            </td>
                            <td class="text-center"><span class="text-muted">—</span></td>
                        </tr>
                        {% endwith %}

                        {# Phone number #}
                        {% with field=sform.order_phone_asked_required %}
                        {% if field %}
                        <tr>
                            <th>{% trans "Phone number" %}</th>
                            <td class="text-center">
                                <label class="toggle-switch" data-field-id="{{ field.auto_id }}"
                                    aria-label="Toggle active state for Phone number">
                                    <input type="checkbox" {% if field.value != 'do_not_ask' %}checked{% endif %}
                                        aria-label="Active toggle for Phone number">
                                    <span class="toggle-slider"></span>
                                </label>
                                <input type="hidden" name="{{ field.html_name }}" value="{{ field.value }}"
                                    id="{{ field.auto_id }}">
                            </td>
                            <td class="text-center">
                                <div class="required-status-wrapper" data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}">
                                    <select class="required-status-dropdown" data-field-id="{{ field.auto_id }}"
                                        data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}"
                                        aria-label="Required status for Phone number">
                                        <option value="optional" {% if field.value == 'optional' or field.value == 'do_not_ask' %}selected{% endif %}>Optional</option>
                                        <option value="required" {% if field.value == 'required' %}selected{% endif %}>Required</option>
                                    </select>
                                </div>
                            </td>
                            <td class="text-center"><span class="text-muted">—</span></td>
                        </tr>
                        {% endif %}
                        {% endwith %}

                        {# Name and address - static link #}
                        <tr>
                            <th>{% trans "Name and address" %}</th>
                            <td colspan="3">
                                <a href="{% url "control:event.settings.invoice" event=request.event.slug organizer=request.organizer.slug %}#tab-0-1-open" target="_blank">
                                    {% trans "See invoice settings" %}
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </fieldset>

        <fieldset>
            <legend>{% trans "Attendee data (once per admission ticket)" %}</legend>
            <div class="table-responsive-sm">
                <table class="table table-sm order-form-option-table">
                    <colgroup>
                        <col class="field-col" style="width: auto;">
                        <col style="width: 115px;">
                        <col style="width: 150px;">
                        <col style="width: 135px;">
                    </colgroup>
                    <thead>
                        <tr>
                            <th>{% trans "Field" %}</th>
                            <th class="text-center">{% trans "Active" %}</th>
                            <th class="text-center">{% trans "Required" %}</th>
                            <th class="text-center">{% trans "Settings" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {# Attendee names #}
                        {% with field=sform.attendee_names_asked_required %}
                        {% if field %}
                        <tr>
                            <th>{% trans "Attendee names" %}</th>
                            <td class="text-center">
                                <label class="toggle-switch" data-field-id="{{ field.auto_id }}"
                                    aria-label="Toggle active state for Attendee names">
                                    <input type="checkbox" {% if field.value != 'do_not_ask' %}checked{% endif %}
                                        aria-label="Active toggle for Attendee names">
                                    <span class="toggle-slider"></span>
                                </label>
                                <input type="hidden" name="{{ field.html_name }}" value="{{ field.value }}"
                                    id="{{ field.auto_id }}">
                            </td>
                            <td class="text-center">
                                <div class="required-status-wrapper" data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}">
                                    <select class="required-status-dropdown" data-field-id="{{ field.auto_id }}"
                                        data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}"
                                        aria-label="Required status for Attendee names">
                                        <option value="optional" {% if field.value == 'optional' or field.value == 'do_not_ask' %}selected{% endif %}>Optional</option>
                                        <option value="required" {% if field.value == 'required' %}selected{% endif %}>Required</option>
                                    </select>
                                </div>
                            </td>
                            <td class="text-center"><span class="text-muted">—</span></td>
                        </tr>
                        {% endif %}
                        {% endwith %}

                        {# Attendee emails #}
                        {% with field=sform.attendee_emails_asked_required %}
                        {% if field %}
                        <tr>
                            <th>{% trans "Attendee emails" %}</th>
                            <td class="text-center">
                                <label class="toggle-switch" data-field-id="{{ field.auto_id }}"
                                    aria-label="Toggle active state for Attendee emails">
                                    <input type="checkbox" {% if field.value != 'do_not_ask' %}checked{% endif %}
                                        aria-label="Active toggle for Attendee emails">
                                    <span class="toggle-slider"></span>
                                </label>
                                <input type="hidden" name="{{ field.html_name }}" value="{{ field.value }}"
                                    id="{{ field.auto_id }}">
                            </td>
                            <td class="text-center">
                                <div class="required-status-wrapper" data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}">
                                    <select class="required-status-dropdown" data-field-id="{{ field.auto_id }}"
                                        data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}"
                                        aria-label="Required status for Attendee emails">
                                        <option value="optional" {% if field.value == 'optional' or field.value == 'do_not_ask' %}selected{% endif %}>Optional</option>
                                        <option value="required" {% if field.value == 'required' %}selected{% endif %}>Required</option>
                                    </select>
                                </div>
                            </td>
                            <td class="text-center"><span class="text-muted">—</span></td>
                        </tr>
                        {% endif %}
                        {% endwith %}

                        {# Attendee company #}
                        {% with field=sform.attendee_company_asked_required %}
                        {% if field %}
                        <tr>
                            <th>{% trans "Company" %}</th>
                            <td class="text-center">
                                <label class="toggle-switch" data-field-id="{{ field.auto_id }}"
                                    aria-label="Toggle active state for Company">
                                    <input type="checkbox" {% if field.value != 'do_not_ask' %}checked{% endif %}
                                        aria-label="Active toggle for Company">
                                    <span class="toggle-slider"></span>
                                </label>
                                <input type="hidden" name="{{ field.html_name }}" value="{{ field.value }}"
                                    id="{{ field.auto_id }}">
                            </td>
                            <td class="text-center">
                                <div class="required-status-wrapper" data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}">
                                    <select class="required-status-dropdown" data-field-id="{{ field.auto_id }}"
                                        data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}"
                                        aria-label="Required status for Company">
                                        <option value="optional" {% if field.value == 'optional' or field.value == 'do_not_ask' %}selected{% endif %}>Optional</option>
                                        <option value="required" {% if field.value == 'required' %}selected{% endif %}>Required</option>
                                    </select>
                                </div>
                            </td>
                            <td class="text-center"><span class="text-muted">—</span></td>
                        </tr>
                        {% endif %}
                        {% endwith %}

                        {# Attendee addresses #}
                        {% with field=sform.attendee_addresses_asked_required %}
                        {% if field %}
                        <tr>
                            <th>{% trans "Postal addresses" %}</th>
                            <td class="text-center">
                                <label class="toggle-switch" data-field-id="{{ field.auto_id }}"
                                    aria-label="Toggle active state for Postal addresses">
                                    <input type="checkbox" {% if field.value != 'do_not_ask' %}checked{% endif %}
                                        aria-label="Active toggle for Postal addresses">
                                    <span class="toggle-slider"></span>
                                </label>
                                <input type="hidden" name="{{ field.html_name }}" value="{{ field.value }}"
                                    id="{{ field.auto_id }}">
                            </td>
                            <td class="text-center">
                                <div class="required-status-wrapper" data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}">
                                    <select class="required-status-dropdown" data-field-id="{{ field.auto_id }}"
                                        data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}"
                                        aria-label="Required status for Postal addresses">
                                        <option value="optional" {% if field.value == 'optional' or field.value == 'do_not_ask' %}selected{% endif %}>Optional</option>
                                        <option value="required" {% if field.value == 'required' %}selected{% endif %}>Required</option>
                                    </select>
                                </div>
                            </td>
                            <td class="text-center"><span class="text-muted">—</span></td>
                        </tr>
                        {% endif %}
                        {% endwith %}
                    </tbody>
                </table>
            </div>
            {% bootstrap_field sform.attendee_data_explanation_text layout="control" %}
        </fieldset>

        <fieldset>
            <legend>{% trans "Form settings" %}</legend>
            {% bootstrap_field sform.require_registered_account_for_tickets layout="control" %}
            {% bootstrap_field sform.include_wikimedia_username layout="control" %}
            {% bootstrap_field sform.name_scheme layout="control" %}
            {% bootstrap_field sform.name_scheme_titles layout="control" %}
            {% bootstrap_field sform.checkout_show_copy_answers_button layout="control" %}
        </fieldset>
        
        <div class="form-group submit-group">
            <button type="submit" class="btn btn-primary btn-save">
                {% trans "Save" %}
            </button>
        </div>
    </form>
{% endblock %}