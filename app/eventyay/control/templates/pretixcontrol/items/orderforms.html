{% extends "pretixcontrol/items/base.html" %}
{% load i18n %}
{% load bootstrap3 %}
{% load rich_text %}
{% load static %}
{% block title %}{% trans "Order forms" %}{% endblock %}
{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'orga/css/question-toggles.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'pretixcontrol/css/orderforms.css' %}">
{% endblock %}
{% block inside %}
    <nav id="event-nav" class="header-nav">
        <div class="navigation">
            <div class="navigation-title">
                <h1>{% trans "Order forms" %}</h1>
            </div>
            {% include "pretixcontrol/event/component_link.html" %}
        </div>
    </nav>
    
    <form action="" method="post" class="form-horizontal" enctype="multipart/form-data">
        {% csrf_token %}
        {% bootstrap_form_errors sform %}
        
        <fieldset>
            <legend>{% trans "Customer data (once per order)" %}</legend>
            <div class="table-responsive-sm offset-md-3">
                <table class="table table-sm table-flip table-sticky order-forms-table">
                    <thead>
                        <tr>
                            <th>{% trans "Field" %}</th>
                            <th class="text-center">{% trans "Active" %}</th>
                            <th class="text-center">{% trans "Required" %}</th>
                            <th>{% trans "Settings" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {# Email Address #}
                        {% with field=sform.order_email_asked_required %}
                        <tr>
                            <th>{% trans "Email address" %}</th>
                            <td class="text-center">
                                <label class="toggle-switch" data-field-id="{{ field.auto_id }}"
                                    aria-label="Toggle active state for Email address">
                                    <input type="checkbox" 
                                        {% if field.value == 'required' or field.value == 'optional' %}checked{% endif %}
                                        aria-label="Active toggle for Email address">
                                    <span class="toggle-slider"></span>
                                </label>
                                <input type="hidden" name="{{ field.html_name }}" value="{{ field.value }}"
                                    id="{{ field.auto_id }}">
                            </td>
                            <td class="text-center">
                                <div class="required-status-wrapper" 
                                    data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}">
                                    <select class="required-status-dropdown" data-field-id="{{ field.auto_id }}"
                                        data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}"
                                        aria-label="Required status for Email address">
                                        <option value="optional" {% if field.value == 'optional' or field.value == 'do_not_ask' %}selected{% endif %}>{% trans "Optional" %}</option>
                                        <option value="required" {% if field.value == 'required' %}selected{% endif %}>{% trans "Required" %}</option>
                                    </select>
                                </div>
                            </td>
                            <td>
                                <span class="text-muted small">
                                    {% trans "Primary order contact email" %}
                                </span>
                            </td>
                        </tr>
                        {% endwith %}

                        {# Email Address (Confirm) #}
                        {% with field=sform.order_email_asked_twice %}
                        <tr>
                            <th>{% trans "Email address (confirm)" %}</th>
                            <td class="text-center">
                                <label class="toggle-switch" data-field-id="{{ field.auto_id }}"
                                    aria-label="Toggle active state for Email confirmation">
                                    <input type="checkbox" {% if field.value %}checked{% endif %}
                                        aria-label="Active toggle for Email confirmation">
                                    <span class="toggle-slider"></span>
                                </label>
                                <input type="hidden" name="{{ field.html_name }}" value="{{ field.value|yesno:'True,False' }}"
                                    id="{{ field.auto_id }}">
                            </td>
                            <td class="text-center">
                                <span class="text-muted">—</span>
                            </td>
                            <td>
                                <span class="text-muted small">
                                    {% trans "Ask customer to confirm email address" %}
                                </span>
                            </td>
                        </tr>
                        {% endwith %}

                        {# Phone Number #}
                        {% with field=sform.order_phone_asked_required %}
                        <tr>
                            <th>{% trans "Phone number" %}</th>
                            <td class="text-center">
                                <label class="toggle-switch" data-field-id="{{ field.auto_id }}"
                                    aria-label="Toggle active state for Phone number">
                                    <input type="checkbox" 
                                        {% if field.value == 'required' or field.value == 'optional' %}checked{% endif %}
                                        aria-label="Active toggle for Phone number">
                                    <span class="toggle-slider"></span>
                                </label>
                                <input type="hidden" name="{{ field.html_name }}" value="{{ field.value }}"
                                    id="{{ field.auto_id }}">
                            </td>
                            <td class="text-center">
                                <div class="required-status-wrapper" 
                                    data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}">
                                    <select class="required-status-dropdown" data-field-id="{{ field.auto_id }}"
                                        data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}"
                                        aria-label="Required status for Phone number">
                                        <option value="optional" {% if field.value == 'optional' or field.value == 'do_not_ask' %}selected{% endif %}>{% trans "Optional" %}</option>
                                        <option value="required" {% if field.value == 'required' %}selected{% endif %}>{% trans "Required" %}</option>
                                    </select>
                                </div>
                            </td>
                            <td>
                                <span class="text-muted small">
                                    {% trans "Order contact phone number" %}
                                </span>
                            </td>
                        </tr>
                        {% endwith %}

                        {# Name and Address #}
                        <tr>
                            <th>{% trans "Name and address" %}</th>
                            <td class="text-center">
                                <span class="text-muted">—</span>
                            </td>
                            <td class="text-center">
                                <span class="text-muted">—</span>
                            </td>
                            <td>
                                <a href="{% url "control:event.settings.invoice" event=request.event.slug organizer=request.organizer.slug %}#tab-0-1-open" 
                                   target="_blank" class="btn btn-sm btn-default">
                                    <i class="fa fa-external-link"></i>
                                    {% trans "See invoice settings" %}
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </fieldset>

        <fieldset>
            <legend>{% trans "Attendee data (once per admission ticket)" %}</legend>
            <div class="table-responsive-sm offset-md-3">
                <table class="table table-sm table-flip table-sticky order-forms-table">
                    <thead>
                        <tr>
                            <th>{% trans "Field" %}</th>
                            <th class="text-center">{% trans "Active" %}</th>
                            <th class="text-center">{% trans "Required" %}</th>
                            <th>{% trans "Settings" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {# Attendee Name #}
                        {% with field=sform.attendee_names_asked_required %}
                        <tr>
                            <th>{% trans "Attendee name" %}</th>
                            <td class="text-center">
                                <label class="toggle-switch" data-field-id="{{ field.auto_id }}"
                                    aria-label="Toggle active state for Attendee name">
                                    <input type="checkbox" 
                                        {% if field.value == 'required' or field.value == 'optional' %}checked{% endif %}
                                        aria-label="Active toggle for Attendee name">
                                    <span class="toggle-slider"></span>
                                </label>
                                <input type="hidden" name="{{ field.html_name }}" value="{{ field.value }}"
                                    id="{{ field.auto_id }}">
                            </td>
                            <td class="text-center">
                                <div class="required-status-wrapper" 
                                    data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}">
                                    <select class="required-status-dropdown" data-field-id="{{ field.auto_id }}"
                                        data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}"
                                        aria-label="Required status for Attendee name">
                                        <option value="optional" {% if field.value == 'optional' or field.value == 'do_not_ask' %}selected{% endif %}>{% trans "Optional" %}</option>
                                        <option value="required" {% if field.value == 'required' %}selected{% endif %}>{% trans "Required" %}</option>
                                    </select>
                                </div>
                            </td>
                            <td>
                                <span class="text-muted small">
                                    {% trans "Name of ticket holder" %}
                                </span>
                            </td>
                        </tr>
                        {% endwith %}

                        {# Attendee Email #}
                        {% with field=sform.attendee_emails_asked_required %}
                        <tr>
                            <th>{% trans "Attendee email" %}</th>
                            <td class="text-center">
                                <label class="toggle-switch" data-field-id="{{ field.auto_id }}"
                                    aria-label="Toggle active state for Attendee email">
                                    <input type="checkbox" 
                                        {% if field.value == 'required' or field.value == 'optional' %}checked{% endif %}
                                        aria-label="Active toggle for Attendee email">
                                    <span class="toggle-slider"></span>
                                </label>
                                <input type="hidden" name="{{ field.html_name }}" value="{{ field.value }}"
                                    id="{{ field.auto_id }}">
                            </td>
                            <td class="text-center">
                                <div class="required-status-wrapper" 
                                    data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}">
                                    <select class="required-status-dropdown" data-field-id="{{ field.auto_id }}"
                                        data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}"
                                        aria-label="Required status for Attendee email">
                                        <option value="optional" {% if field.value == 'optional' or field.value == 'do_not_ask' %}selected{% endif %}>{% trans "Optional" %}</option>
                                        <option value="required" {% if field.value == 'required' %}selected{% endif %}>{% trans "Required" %}</option>
                                    </select>
                                </div>
                            </td>
                            <td>
                                <span class="text-muted small">
                                    {% trans "Individual email per ticket" %}
                                </span>
                            </td>
                        </tr>
                        {% endwith %}

                        {# Company #}
                        {% with field=sform.attendee_company_asked_required %}
                        <tr>
                            <th>{% trans "Company" %}</th>
                            <td class="text-center">
                                <label class="toggle-switch" data-field-id="{{ field.auto_id }}"
                                    aria-label="Toggle active state for Company">
                                    <input type="checkbox" 
                                        {% if field.value == 'required' or field.value == 'optional' %}checked{% endif %}
                                        aria-label="Active toggle for Company">
                                    <span class="toggle-slider"></span>
                                </label>
                                <input type="hidden" name="{{ field.html_name }}" value="{{ field.value }}"
                                    id="{{ field.auto_id }}">
                            </td>
                            <td class="text-center">
                                <div class="required-status-wrapper" 
                                    data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}">
                                    <select class="required-status-dropdown" data-field-id="{{ field.auto_id }}"
                                        data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}"
                                        aria-label="Required status for Company">
                                        <option value="optional" {% if field.value == 'optional' or field.value == 'do_not_ask' %}selected{% endif %}>{% trans "Optional" %}</option>
                                        <option value="required" {% if field.value == 'required' %}selected{% endif %}>{% trans "Required" %}</option>
                                    </select>
                                </div>
                            </td>
                            <td>
                                <span class="text-muted small">
                                    {% trans "Attendee company name" %}
                                </span>
                            </td>
                        </tr>
                        {% endwith %}

                        {# Postal Address #}
                        {% with field=sform.attendee_addresses_asked_required %}
                        <tr>
                            <th>{% trans "Postal address" %}</th>
                            <td class="text-center">
                                <label class="toggle-switch" data-field-id="{{ field.auto_id }}"
                                    aria-label="Toggle active state for Postal address">
                                    <input type="checkbox" 
                                        {% if field.value == 'required' or field.value == 'optional' %}checked{% endif %}
                                        aria-label="Active toggle for Postal address">
                                    <span class="toggle-slider"></span>
                                </label>
                                <input type="hidden" name="{{ field.html_name }}" value="{{ field.value }}"
                                    id="{{ field.auto_id }}">
                            </td>
                            <td class="text-center">
                                <div class="required-status-wrapper" 
                                    data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}">
                                    <select class="required-status-dropdown" data-field-id="{{ field.auto_id }}"
                                        data-current="{% if field.value == 'required' %}required{% else %}optional{% endif %}"
                                        aria-label="Required status for Postal address">
                                        <option value="optional" {% if field.value == 'optional' or field.value == 'do_not_ask' %}selected{% endif %}>{% trans "Optional" %}</option>
                                        <option value="required" {% if field.value == 'required' %}selected{% endif %}>{% trans "Required" %}</option>
                                    </select>
                                </div>
                            </td>
                            <td>
                                <span class="text-muted small">
                                    {% trans "Full postal address per ticket" %}
                                </span>
                            </td>
                        </tr>
                        {% endwith %}

                        {# Attendee Data Explanation #}
                        {% with field=sform.attendee_data_explanation_text %}
                        <tr>
                            <th colspan="4" class="bg-light">
                                <div class="form-group mb-0">
                                    <label for="{{ field.auto_id }}" class="control-label">
                                        {{ field.label }}
                                    </label>
                                    {{ field }}
                                    {% if field.help_text %}
                                        <p class="help-block">{{ field.help_text|safe }}</p>
                                    {% endif %}
                                    {% if field.errors %}
                                        <div class="alert alert-danger">
                                            {{ field.errors }}
                                        </div>
                                    {% endif %}
                                </div>
                            </th>
                        </tr>
                        {% endwith %}
                    </tbody>
                </table>
            </div>
        </fieldset>

        <fieldset>
            <legend>{% trans "Form settings" %}</legend>
            {% bootstrap_field sform.require_registered_account_for_tickets layout="control" %}
            {% bootstrap_field sform.include_wikimedia_username layout="control" %}
            {% bootstrap_field sform.name_scheme layout="control" %}
            {% bootstrap_field sform.name_scheme_titles layout="control" %}
            {% bootstrap_field sform.checkout_show_copy_answers_button layout="control" %}
        </fieldset>
        
        <div class="form-group submit-group">
            <button type="submit" class="btn btn-primary btn-save">
                {% trans "Save" %}
            </button>
        </div>
    </form>
{% endblock %}

{% block extrascript %}
<script src="{% static 'pretixcontrol/js/ui/orderforms.js' %}"></script>
{% endblock %}