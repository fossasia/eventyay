{% extends 'account/base.jinja' %}

{% block head_title %}
  {{ _('Reset Password') }}
{% endblock head_title %}

{% block extra_head %}
  <style>
    .password-reset-container {
      max-width: 500px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    .password-form {
      width: 100%;
      margin-top: 1.5rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
      text-align: left;
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #2c3e50;
      font-size: 0.95rem;
    }

    .password-reset-container .form-group label {
      text-align: left;
    }

    .form-group .required {
      color: #e74c3c;
      margin-left: 2px;
    }

    .form-group input[type='password'],
    .form-group input[type='text'],
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
      transition: border-color 0.2s;
      box-sizing: border-box;
    }

    .form-group input[type='password']:focus {
      outline: none;
      border-color: #2185d0;
      box-shadow: 0 0 0 3px rgba(33, 133, 208, 0.1);
    }

    .form-group input[type='text']:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #2185d0;
      box-shadow: 0 0 0 3px rgba(33, 133, 208, 0.1);
    }

    .field-error {
      margin-top: 0.5rem;
      padding: 0.5rem;
      background-color: #fee;
      border-left: 3px solid #e74c3c;
      border-radius: 3px;
    }

    .field-error span {
      display: block;
      color: #c0392b;
      font-size: 0.9rem;
    }

    .field-help {
      margin-top: 0.5rem;
      font-size: 0.85rem;
      color: #7f8c8d;
      line-height: 1.4;
    }

    .description {
      text-align: left;
      color: #555;
      line-height: 1.6;
      margin-bottom: 1.5rem;
    }

    .alert {
      padding: 1rem;
      margin-bottom: 1.5rem;
      border-radius: 4px;
      text-align: left;
    }

    .alert-danger {
      background-color: #fee;
      border: 1px solid #fcc;
      color: #c0392b;
    }

    .alert-warning {
      background-color: #ffeaa7;
      border: 1px solid #fdcb6e;
      color: #d63031;
    }

    .alert .fa {
      margin-right: 0.5rem;
    }

    .alert p {
      margin: 0.5rem 0 0 0;
    }

    .additional-links {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid #ecf0f1;
    }

    .btn-group {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 1.5rem;
    }

    .btn {
      display: inline-block;
      padding: 0.75rem 1.5rem;
      border-radius: 4px;
      text-decoration: none;
      font-weight: 500;
      transition: background-color 0.2s;
      text-align: center;
    }

    .btn-primary {
      background-color: #2185d0;
      color: white;
      border: 1px solid #2185d0;
    }

    .btn-primary:hover {
      background-color: #1b6ba8;
    }

    .btn-default {
      background-color: #f5f5f5;
      color: #333;
      border: 1px solid #ddd;
    }

    .btn-default:hover {
      background-color: #e9e9e9;
    }

    .btn-lg {
      padding: 0.9rem 2rem;
      font-size: 1.1rem;
      width: 100%;
    }

    .btn .fa {
      margin-right: 0.5rem;
    }

    @media (max-width: 480px) {
      .password-reset-container {
        margin: 1rem auto;
      }

      .form-group input[type='password'] {
        font-size: 16px; /* Prevents zoom on iOS */
      }

      .btn {
        display: block;
        width: 100%;
      }

      .btn-group {
        flex-direction: column;
        gap: 0;
      }

      .btn-group .btn {
        margin-bottom: 0.5rem;
      }
    }
  </style>
{% endblock extra_head %}

{% block content %}
  <div class='password-reset-container'>
    <h1>{{ _('Reset Password') }}</h1>

    {% if form.errors %}
      <div class='alert alert-danger'>
        <i class='fa fa-exclamation-triangle'></i>
        {{ _('Please correct the errors below.') }}
      </div>
    {% endif %}

    {% if token_fail %}
      <div class='alert alert-warning'>
        <i class='fa fa-warning'></i>
        <p>
          {{ _('The password reset link was invalid, possibly because it has already been used.') }}
          {{ _('Please request a new password reset link below.') }}
        </p>
      </div>

      <div class='btn-group'>
        <a href="{{ url_for('account_reset_password') }}" class='btn btn-primary'>
          <i class='fa fa-envelope'></i>
          {{ _('Request Password Reset') }}
        </a>

        <a href="{{ url_for('eventyay_common:auth.login') }}" class='btn btn-default'>
          <i class='fa fa-sign-in'></i>
          {{ _('Back to Login') }}
        </a>
      </div>
    {% else %}
      <p class='description'>
        {{ _('Please enter your new password twice so we can verify you typed it in correctly.') }}
      </p>

      <form method='post' action="{{ action_url }}" class='password-form'>
        <input type='hidden' name='csrfmiddlewaretoken' value='{{ csrf_token }}'>

        <div class='form-group'>
          <label for='password1'>
            {{ form.password1.label }}
            {% if form.password1.field.required %}<span class='required'>*</span>{% endif %}
          </label>
          {{ form.password1 }}
          {% if form.password1.errors %}
            <div class='field-error'>
              {% for error in form.password1.errors %}
                <span>{{ error }}</span>
              {% endfor %}
            </div>
          {% endif %}
          {% if form.password1.help_text %}
            <div class='field-help'>{{ form.password1.help_text }}</div>
          {% endif %}
        </div>

        <div class='form-group'>
          <label for='password2'>
            {{ form.password2.label }}
            {% if form.password2.field.required %}<span class='required'>*</span>{% endif %}
          </label>
          {{ form.password2 }}
          {% if form.password2.errors %}
            <div class='field-error'>
              {% for error in form.password2.errors %}
                <span>{{ error }}</span>
              {% endfor %}
            </div>
          {% endif %}
          {% if form.password2.help_text %}
            <div class='field-help'>{{ form.password2.help_text }}</div>
          {% endif %}
        </div>

        <button type='submit' class='btn btn-primary btn-lg'>
          <i class='fa fa-lock'></i>
          {{ _('Reset Password') }}
        </button>

        <div class='additional-links'>
          <a href="{{ url_for('eventyay_common:auth.login') }}" class='btn btn-default'>
            <i class='fa fa-sign-in'></i>
            {{ _('Back to Login') }}
          </a>
        </div>
      </form>
    {% endif %}
  </div>
{% endblock content %}
