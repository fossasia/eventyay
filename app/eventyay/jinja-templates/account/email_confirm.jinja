{% extends 'account/base.jinja' %}

{% block head_title %}
  {{ _('Confirm Email Address') }}
{% endblock head_title %}

{% block content %}
  <div class='email-confirm-container'>
    <h1>{{ _('Confirm Email Address') }}</h1>

    {% if confirmation %}
      {% set user_display = confirmation.email_address.user.get_full_name() or confirmation.email_address.user.email %}

      {% if can_confirm %}
        <div class='alert alert-info'>
          <p>
            {{ _('Please confirm that <a href="mailto:%(email)s">%(email)s</a> is an email address for user %(user)s.',
                 email=confirmation.email_address.email, user=user_display)|safe }}
          </p>
        </div>

        <form method='post' action="{{ url_for('account_confirm_email', key=confirmation.key) }}">
          <input type='hidden' name='csrfmiddlewaretoken' value='{{ csrf_token }}'>
          {{ redirect_field }}

          <button type='submit' class='btn btn-primary btn-lg'>
            <i class='fa fa-check'></i>
            {{ _('Confirm') }}
          </button>

          <a href="{{ url_for('eventyay_common:dashboard') }}" class='btn btn-default'>
            <i class='fa fa-times'></i>
            {{ _('Cancel') }}
          </a>
        </form>
      {% else %}
        <div class='alert alert-danger'>
          <p>
            {{ _('Unable to confirm %(email)s because it is already confirmed by a different account.',
                 email=confirmation.email_address.email) }}
          </p>
        </div>

        <a href="{{ url_for('eventyay_common:dashboard') }}" class='btn btn-default'>
          <i class='fa fa-arrow-left'></i>
          {{ _('Return to Dashboard') }}
        </a>
      {% endif %}
    {% else %}
      <div class='alert alert-warning'>
        <p>
          {{ _('This email confirmation link expired or is invalid. Please <a href="%(email_url)s">issue a new email confirmation request</a>.',
               email_url=url_for('eventyay_common:account.email'))|safe }}
        </p>
      </div>

      <div class='btn-group'>
        <a href="{{ url_for('eventyay_common:account.email') }}" class='btn btn-primary'>
          <i class='fa fa-envelope'></i>
          {{ _('Manage Email Addresses') }}
        </a>

        <a href="{{ url_for('eventyay_common:dashboard') }}" class='btn btn-default'>
          <i class='fa fa-arrow-left'></i>
          {{ _('Return to Dashboard') }}
        </a>
      </div>
    {% endif %}
  </div>
{% endblock content %}
