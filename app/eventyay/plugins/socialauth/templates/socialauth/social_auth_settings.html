{% extends "pretixcontrol/admin/base.html" %}
{% load i18n %}
{% load bootstrap3 %}
{% load rich_text %}
{% load static %}
{% load compress %}

{% block title %}{% translate "Social login settings" %}{% endblock %}

{% block custom_header %}
    {{ block.super }}
    {% compress css %}
        <link rel="stylesheet" type="text/css" href="{% static 'eventyay/css/social_auth_settings.css' %}">
    {% endcompress %}
{% endblock %}

{% block content %}
    <nav id="event-nav" class="header-nav">
        <div class="navigation">
            <div class="navigation-title">
                <h1>{% translate "Social login settings" %}</h1>
            </div>
            {% include "pretixcontrol/event/component_link.html" %}
        </div>
    </nav>
    <form action="" method="post" class="form-horizontal form-plugins">
        {% csrf_token %}
        {% if "success" in request.GET %}
            <div class="alert alert-success">
                {% translate "Your changes have been saved." %}
            </div>
        {% endif %}
        <div class="tabbed-form">
            <fieldset>
                <legend>{% translate "Social login providers" %}</legend>
                <div class="table-responsive">
                    <table class="table">
                        <tbody>
                            {# Individual provider settings #}
                            {% for provider, settings in login_providers.items %}
                                <tr class="{% if settings.state %}success{% else %}default{% endif %}">
                                    <td>
                                        {% with provider|capfirst as provider_capitalized %}
                                            <strong>{% translate provider_capitalized %}</strong>
                                            <p>{% blocktranslate %}Login with {{ provider_capitalized }}{% endblocktranslate %}</p>
                                        {% endwith %}
                                    </td>
                                    <td class="text-right flip" width="20%">
                                        {# Enable/Disable button for each provider #}
                                        {% if settings.state %}
                                            <button class="btn btn-default btn-block" name="{{ provider }}_login" value="disabled">
                                                {% translate "Disable" %}
                                            </button>
                                        {% else %}
                                            <button class="btn btn-default btn-block" name="{{ provider }}_login" value="enabled">
                                                {% translate "Enable" %}
                                            </button>
                                        {% endif %}
                                    </td>
                                </tr>
                                {# Configuration fields shown only when provider is enabled #}
                                {% if settings.state %}
                                    <tr>
                                        <td colspan="2">
                                            {# Client ID / Application Key field #}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">
                                                    {# MediaWiki uses different terminology for OAuth credentials #}
                                                    {% if provider == "mediawiki" %}
                                                        {% translate "Client Application Key" %}
                                                    {% else %}
                                                        {% translate "Client ID" %}
                                                    {% endif %}
                                                </label>
                                                <div class="col-sm-9">
                                                    <input type="text" class="form-control" name="{{ provider }}_client_id" value="{{ settings.client_id }}">
                                                </div>
                                            </div>
                                            {# Client Secret field #}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">
                                                    {% if provider == "mediawiki" %}
                                                        {% translate "Client Application Secret" %}
                                                    {% else %}
                                                        {% translate "Secret" %}
                                                    {% endif %}
                                                </label>
                                                <div class="col-sm-9">
                                                    <input type="password" class="form-control" name="{{ provider }}_secret" value="{{ settings.secret }}">
                                                </div>
                                            </div>
                                            {# Preferred provider selection radio button #}
                                            <div class="form-group">
                                                <div class="col-sm-offset-3 col-sm-9">
                                                    <div class="radio">
                                                        <label>
                                                            {# Radio button to mark this provider as preferred - checked if is_preferred is true #}
                                                            <input type="radio"
                                                                   name="preferred_provider"
                                                                   value="{{ provider }}"
                                                                   {% if settings.is_preferred %}checked{% endif %}>
                                                            {% translate "Make this login the preferred login method" %}
                                                        </label>
                                                    </div>
                                                    {# Help text explaining what preferred provider means #}
                                                    <p class="help-block">
                                                        {% translate "The preferred login method will appear first in the login UI and 'Keep me logged in' will be pre-selected by default." %}
                                                    </p>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                {% endif %}
                            {% endfor %}

                            {# Option to clear preferred provider selection - moved to bottom for better UX #}
                            <tr>
                                <td colspan="2" class="no-preferred-section">
                                    <div class="form-group no-preferred-form-group">
                                        <div class="radio">
                                            <label>
                                                {# Radio button to clear preferred provider - checked if no provider is preferred #}
                                                <input type="radio"
                                                       name="preferred_provider"
                                                       value=""
                                                       {% if not any_preferred %}checked{% endif %}>
                                                {% translate "No preferred provider (all providers shown equally)" %}
                                            </label>
                                        </div>
                                        {# Help text explaining the no-preference option #}
                                        <p class="help-block no-preferred-help-text">
                                            {% translate "Select this option if you want all enabled login providers to be displayed equally, without any provider being highlighted or pre-selected." %}
                                        </p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </fieldset>
            <fieldset>
                {% include "socialauth/social_setup.html" %}
            </fieldset>
        </div>
        <div class="form-group submit-group">
            <button type="submit" class="btn btn-primary btn-save" name="save_credentials" value="credentials">
                {% translate "Save" %}
            </button>
        </div>
    </form>
{% endblock %}
