{% extends "pretixpresale/event/base.html" %}
{% load i18n %}
{% load l10n %}
{% load eventurl %}
{% load money %}
{% load thumb %}
{% load eventsignal %}
{% load rich_text %}
{% load compress %}
{% load static %}

{% block custom_header %}
    {{ block.super }}
    <meta property="og:title" content="{{ ev.name }}" />
    <meta property="og:description" content="{{ ev.get_date_range_display }}" />
    {% if subevent %}
        <meta property="og:url" content="{% abseventurl request.event "presale:event.index" subevent=subevent.pk %}" />
    {% else %}
        <meta property="og:url" content="{% abseventurl request.event "presale:event.index" %}" />
    {% endif %}
{% endblock %}
{% block content %}

    {% autoescape off %}
        <script type="application/ld+json">
            {{ ev.event_microdata }}
        </script>
    {% endautoescape %}
    <main aria-label="{% trans "General information" %}">
        {% if request.event.has_subevents %}
            {% if not subevent %}
                {% if event_logo_image and request.event.settings.logo_show_title %}
                    <h2 class="content-header">
                        {{ event.name }}
                    </h2>
                {% endif %}
                {% if frontpage_text and not cart_namespace %}
                    <div>
                        {{ frontpage_text|rich_text }}
                    </div>
                {% endif %}
            {% endif %}

            {% if subevent %}
                <h2 class="subevent-head">{{ subevent.name }}</h2>
                {% if frontpage_text and not cart_namespace %}
                    <div>
                        {{ frontpage_text|rich_text }}
                    </div>
                {% endif %}
            {% endif %}
        {% else %}
            {% if event_logo_image and request.event.settings.logo_show_title %}
                <h2 class="content-header">
                    {{ event.name }}
                    {% if request.event.settings.show_dates_on_frontpage %}
                        <small>{{ event.get_date_range_display }}</small>
                    {% endif %}
                </h2>
            {% endif %}
            {% if not event_logo_image %}
                <h2 class="content-header">
                    {{ event.name }}
                    {% if request.event.settings.show_dates_on_frontpage %}
                        <small>{{ event.get_date_range_display }}</small>
                    {% endif %}
                </h2>
            {% endif %}
            {% if frontpage_text and not cart_namespace %}
                <div>
                    {{ frontpage_text|rich_text }}
                </div>
            {% endif %}
        {% endif %}

        {% if subevent or not event.has_subevents %}
            {% if not cart_namespace or subevent %}
                <div>
                    {% if ev.location %}
                        <div class="info-row">
                            <span class="fa fa-map-marker fa-fw" aria-hidden="true"></span>
                            <p><span class="sr-only">{% trans "Location" %}:</span>
                                {{ ev.location|linebreaksbr }}
                            </p>
                        </div>
                    {% endif %}
                    {% if ev.settings.show_dates_on_frontpage %}
                        <div class="info-row">
                            <span class="fa fa-clock-o fa-fw" aria-hidden="true"></span>
                            <p>
                                {{ ev.get_date_range_display }}
                                {% if event.settings.show_times %}
                                    <br>
                                    <span data-time="{{ ev.date_from.isoformat }}" data-timezone="{{ request.event.settings.timezone }}">
                                        {% blocktrans trimmed with time=ev.date_from|date:"TIME_FORMAT" %}
                                            Begin: {{ time }}
                                        {% endblocktrans %}
                                    </span>
                                    {% if event.settings.show_date_to and ev.date_to %}
                                        <br>
                                        <span data-time="{{ ev.date_to.isoformat }}" data-timezone="{{ request.event.settings.timezone }}">
                                            {% blocktrans trimmed with time=ev.date_to|date:"TIME_FORMAT" %}
                                                End: {{ time }}
                                            {% endblocktrans %}
                                       </span>
                                    {% endif %}
                                {% endif %}
                                {% if ev.date_admission %}
                                    <br>
                                    {% if ev.date_admission|date:"SHORT_DATE_FORMAT" == ev.date_from|date:"SHORT_DATE_FORMAT" %}
                                        <span data-time="{{ ev.date_admission.isoformat }}" data-timezone="{{ request.event.settings.timezone }}">
                                            {% blocktrans trimmed with time=ev.date_admission|date:"TIME_FORMAT" %}
                                                Admission: {{ time }}
                                            {% endblocktrans %}
                                        </span>
                                    {% else %}
                                        <span data-time="{{ ev.date_admission.isoformat }}" data-timezone="{{ request.event.settings.timezone }}">
                                            {% blocktrans trimmed with datetime=ev.date_admission|date:"SHORT_DATETIME_FORMAT" %}
                                                Admission: {{ datetime }}
                                            {% endblocktrans %}
                                        </span>
                                    {% endif %}
                                {% endif %}
                                <br>
                                {% if subevent %}
                                    <a href="{% eventurl event "presale:event.ical.download" subevent=subevent.pk %}">
                                {% else %}
                                    <a href="{% eventurl event "presale:event.ical.download" %}">
                                {% endif %}
                                    {% trans "Add to Calendar" %}
                                </a>
                            </p>
                        </div>
                    {% endif %}

                </div>

                {% eventsignal event "eventyay.presale.signals.front_page_top" request=request subevent=subevent %}
            {% endif %}
        {% endif %}
    </main>
    {% if guest_checkout_allowed %}
        {% if not cart_namespace %}
            {% eventsignal event "eventyay.presale.signals.front_page_bottom" subevent=subevent request=request %}
            <aside class="front-page" aria-labelledby="if-you-already-ordered-a-ticket">
                <h3 id="if-you-already-ordered-a-ticket">{% trans "If you already ordered a ticket" %}</h3>
                <div>
                    <div class="col-md-8 col-xs-12">
                        <p>
                            {% blocktrans trimmed %}
                                If you want to see or change the status and details of your order, click on the link in
                                one of the
                                emails we sent you during the order process. If you cannot find the link, click on the
                                following button to request the link to your order to be sent to you again.
                            {% endblocktrans %}
                        </p>
                    </div>
                    <div class="col-md-4 col-xs-12">
                        <a class="btn btn-block btn-default" href="{% eventurl event "presale:event.resend_link" %}">
                            {% trans "Resend order links" %}
                        </a>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </aside>
        {% else %}
            {% eventsignal event "eventyay.presale.signals.front_page_bottom_widget" subevent=subevent request=request %}
        {% endif %}
    {% endif %}
{% endblock %}
