{% load i18n %}
{% load eventurl %}
<div id="ajaxerr">
</div>
<div id="loadingmodal">
    <div class="modal-card">
        <div class="modal-card-icon">
            <i class="fa fa-cog big-rotating-icon" aria-hidden="true"></i>
        </div>
        <div class="modal-card-content">
            <h3></h3>
            <p class="text"></p>
            <p class="status">{% translate 'If the process continues for an extended period, feel free to reach out to us.' %}</p>
        </div>
    </div>
</div>
<div id="join-video-popupmodal" hidden aria-live="polite">
    <div class="modal-card join-online-video">
        <div class="modal-card-content-join">
            <div>
                <h3>
                    {% translate "This is a ticketed event. If you ordered a ticket as a guest user, you don't have an account but can still access the ticket using the secret link in your ticket confirmation email. On the tickets page there is also a link to join online sessions." %}
                </h3>
                <h3>
                    {% translate 'As a ticket holder please also check your email for the unique link to join online sessions.' %}
                </h3>
                {% if request.event %}
                    <p class="text">
                        {% translate "Can't find your ticket?" %}
                        <a class="btn btn-link" href='{% eventurl request.event "presale:event.resend_link" %}'>
                            {% translate 'Resend the email' %}
                        </a>
                        {% translate 'to receive it.' %}
                    </p>
                    <p class="text">
                        {% translate 'Want to order a ticket?' %}
                        <a class="btn btn-link" href='{% eventurl request.event "presale:event.index" %}'>
                            {% translate 'Get a ticket here' %}
                        </a>
                    </p>
                {% endif %}
                {% if not request.user.is_authenticated %}
                    <p class="text">
                        {% blocktrans with event_name=event_name %}
                            Want to create a {{ event_name }} account?
                        {% endblocktrans %}
                        <a class="btn btn-link" href='{% url "eventyay_common:auth.register" %}?next={{ request.get_full_path|urlencode }}'>
                            {% translate 'Sign up here' %}
                        </a>
                    </p>
                    <p class="text">
                        {% blocktrans with event_name=event_name %}
                            Already have a {{ event_name }} account?
                        {% endblocktrans %}
                        <a class="btn btn-link" href='{% url "eventyay_common:auth.login" %}?next={{ request.get_full_path|urlencode }}'>
                            {% translate 'Login here' %}
                        </a>
                    </p>
                {% endif %}
            </div>
        </div>
        <div class="join-online-close">
            <button id="join-online-close-button" class="btn btn-default join-online-close-button">Close</button>
        </div>
    </div>
</div>

<!--  Login Required Modal for Checkout -->
<div id="login-required-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 9999;">
    <div style="max-width: 500px; margin: 100px auto; background: white; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); position: relative;">
        <div style="padding: 30px;">
            <h3 style="margin-bottom: 20px; text-align: center;">{% trans "Login Required" %}</h3>
            <p style="text-align: center; margin-bottom: 25px;">{% trans "Please log in to proceed with checkout." %}</p>
            <div style="text-align: center;">
                <a class="btn btn-primary btn-lg btn-block" style="margin-bottom: 15px;" href='{% url "eventyay_common:auth.login" %}?next={% if request.event %}{% eventurl request.event "presale:event.checkout.start" %}{% else %}{{ request.get_full_path|urlencode }}{% endif %}'>
                    <i class="fa fa-sign-in" aria-hidden="true"></i> {% trans "Log in" %}
                </a>
                <p style="color: #666; margin: 15px 0;">{% trans "Don't have an account?" %}</p>
                <a class="btn btn-default btn-block" href='{% url "eventyay_common:auth.register" %}?next={% if request.event %}{% eventurl request.event "presale:event.checkout.start" %}{% else %}{{ request.get_full_path|urlencode }}{% endif %}'>
                    <i class="fa fa-user-plus" aria-hidden="true"></i> {% trans "Create an account" %}
                </a>
            </div>
        </div>
        <div style="padding: 15px; border-top: 1px solid #eee; text-align: right;">
            <button type="button" class="btn btn-default" id="login-modal-cancel">{% trans "Cancel" %}</button>
        </div>
    </div>
</div>
<script>
(function() {
    var modal = document.getElementById('login-required-modal');
    var cancelBtn = document.getElementById('login-modal-cancel');
    if (cancelBtn) { cancelBtn.onclick = function() { modal.style.display = 'none'; }; }
    modal.onclick = function(e) { if (e.target === modal) { modal.style.display = 'none'; } };
    document.addEventListener('click', function(e) {
        var trigger = e.target.closest('[data-target="#login-required-modal"]');
        if (trigger) { e.preventDefault(); modal.style.display = 'block'; }
    });
})();
</script>
